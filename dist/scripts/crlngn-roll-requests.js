var Z=Object.defineProperty;var h=R=>{throw TypeError(R)};var ee=(R,e,t)=>e in R?Z(R,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):R[e]=t;var d=(R,e,t)=>ee(R,typeof e!="symbol"?e+"":e,t),te=(R,e,t)=>e.has(R)||h("Cannot "+t);var b=(R,e,t)=>e.has(R)?h("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(R):e.set(R,t);var a=(R,e,t)=>(te(R,e,"access private method"),t);const H={INIT:"init",READY:"ready"},oe={READY:"socketlib.ready"},g={PRE_ROLL_V2:"dnd5e.preRollV2",PRE_ROLL_ABILITY_CHECK:"dnd5e.preRollAbilityCheck",PRE_ROLL_SAVING_THROW:"dnd5e.preRollSavingThrow",PRE_BEGIN_CONCENTRATING:"dnd5e.preBeginConcentrating",PRE_END_CONCENTRATION:"dnd5e.preEndConcentration",PRE_ROLL_CONCENTRATION_V2:"dnd5e.preRollConcentrationV2",PRE_ROLL_DEATH_SAVE_V2:"dnd5e.preRollDeathSaveV2",PRE_ROLL_SKILL_V2:"dnd5e.preRollSkillV2",PRE_ROLL_TOOL_CHECK_V2:"dnd5e.preRollToolCheckV2",PRE_ROLL_HIT_DIE_V2:"dnd5e.preRollHitDieV2",PRE_ROLL_CLASS_HIT_POINTS:"dnd5e.preRollClassHitPoints",PRE_ROLL_NPC_HIT_POINTS:"dnd5e.preRollNPCHitPoints",PRE_ROLL_INITIATIVE_DIALOG:"dnd5e.preRollInitiativeDialog",PRE_ROLL_INITIATIVE:"dnd5e.preRollInitiative",PRE_ROLL_ATTACK_V2:"dnd5e.preRollAttackV2",PRE_ROLL_DAMAGE_V2:"dnd5e.preRollDamageV2",PRE_ROLL_FORMULA_V2:"dnd5e.preRollFormulaV2",PRE_ROLL_RECHARGE_V2:"dnd5e.preRollRechargeV2",POST_ROLL_CONFIG:"dnd5e.postRollConfiguration"},E="crlngn-roll-requests",_=["%cCarolingian Rolls","color:rgb(47, 151, 161); font-weight: bold;","|"],I=class I{static log(e="",t=[],o=!1){try{const n=game.settings.get(E,"debugMode")||I.debugOn;if(!(o||n))return;console.log(..._,e,...t)}catch{console.log(..._,e,...t)}}static warn(e="",t=[]){console.warn(..._,e,...t)}static error(e,t={ui:!1,console:!0,permanent:!1}){var o;t.ui&&((o=ui.notifications)==null||o.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(..._,e)}};d(I,"debugOn",!1);let r=I;const ne={checkbox:"checkbox"},re={client:"client"},m=()=>({debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_ROLLS.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_ROLLS.settings.debugMode.hint"),propType:Boolean,inputType:ne.checkbox,default:!0,scope:re.client,config:!0}});class O{static registerSettings(){const e=m();Object.entries(e).forEach(async o=>{const n=o[1];r.log("Registering... ",[o]);const l={name:n.label,hint:n.hint,default:n.default,type:n.propType,scope:n.scope,config:n.config,requiresReload:n.requiresReload||!1,onChange:u=>O.apply(n.tag,u)};n.choices&&(l.choices=n.choices),await game.settings.register(E,n.tag,l),O.get(n.tag)===void 0&&O.set(n.tag,n.default),r.log("registerSettings",[n.tag,O.get(n.tag)])})}static get(e,t=E){if(!e)return null;let o=!1;if(t===E)o=game.settings.get(t,e);else{let l=game.settings.storage.get("client")[`${t}.${e}`];l===void 0&&(l=game.settings.storage.get("world").getSetting(`${t}.${e}`)),o=l==null?void 0:l.value,r.log("GET Setting",[l,o])}return o}static set(e,t,o=E){if(!e)return!1;let n=game.settings.storage.get("client")[`${o}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${o}.${e}`)),r.log("Setting",[e,n]);try{game.settings.set(o,e,t)}catch{r.log("Unable to change setting",[e,n])}return!0}}const c=class c{static serializeForTransport(e){return e==null||(e.rolls&&Array.isArray(e.rolls)&&(e.rolls=e.rolls.map(t=>t instanceof Roll?t.toJSON():t)),r.log("ROLLS DATA",[e])),e}static deserializeFromTransport(e){let t={};return e==null?e:(e.rolls&&e.rolls.length>0&&(t={...e,rolls:e.rolls.map(o=>typeof o=="string"?Roll.fromJSON(o):Roll.fromJSON(JSON.stringify(o)))}),r.log("ROLLS RESULT",[t]),t)}};d(c,"socket"),d(c,"initialize",e=>{Hooks.once(oe.READY,()=>{if(r.log("Attempting to register module..."),typeof socketlib>"u"){r.error("SocketUtil Error: socketlib is not loaded. Ensure it is installed and enabled.");return}try{c.socket=socketlib.registerModule(E),e&&e(),r.log("SocketUtil | Module registered",[c.socket])}catch(t){r.log("Problem registering module",[t])}})}),d(c,"registerCall",(e,t)=>{c.socket?(c.socket.register(e,t),r.log("SocketUtil - Registered callback",[c.socket,e])):r.log("SocketUtil - Failed to register callback (socket not initialized)",[c.socket,e])}),d(c,"sendMessage",(e,t)=>{r.log("SocketUtil - sendMessage",[e]),t&&t()}),d(c,"execAsGM",async(e,...t)=>{if(!c.socket){r.log("SocketUtil - Socket not initialized. Cannot execute as GM.");return}return await c.socket.executeAsGM(e,...t)}),d(c,"execForAll",async(e,...t)=>{if(!c.socket){r.log("SocketUtil - Socket not initialized. Cannot execute for all clients.");return}return await c.socket.executeForEveryone(e,...t)}),d(c,"execAsUser",async(e,t,...o)=>{if(!c.socket){r.log("SocketUtil - Socket not initialized. Cannot execute as user.");return}const n=await c.socket.executeAsUser(e,t,...o);return r.log("SocketUtil - Executed as user.",[n]),n});let p=c;class C{static getTargets(e){let t=game.users.find(n=>n.isGM===!0),o=e.targets||t.targets;return new Set([...o])}static getActorFromItem(e){const t=e.split(".")[1];return game.actors.get(t)}static isModuleOn(e){var o;const t=(o=game.modules)==null?void 0:o.get(e);return!!(t!=null&&t.active)}static isPrivateRoll(e){return e===CONST.DICE_ROLL_MODES.BLIND||e===CONST.DICE_ROLL_MODES.PRIVATE}static removeTemplateForItem(e){r.log("removeTemplateForItem - A",[e]);const t=O.get("remove-template");if(r.log("removeTemplateForItem - B",[t]),!t)return;const o=canvas.templates.objects.children.filter(n=>n.document.flags.dnd5e.item===(e==null?void 0:e.uuid));canvas.scene.deleteEmbeddedDocuments("MeasuredTemplate",o.map(n=>n.id))}static getUserFromActor(e){let t;if(!e)return null;const o=e?game.actors.get(e):null;return t=game.users.players.find(l=>l.active===!0&&l.character.id===e),t||game.users.players.forEach(l=>{l.active&&o.testUserPermission(l,foundry.CONST.DOCUMENT_OWNERSHIP_LEVELS.OWNER,{exact:!0})&&(t=l)}),r.log("getUserFromActor",[e,t]),t}static html(e,t){return e.querySelector(t)}}d(C,"getClientTargets",()=>{if(!game.user)return[];const e=Array.from(game.user.targets);return r.log("Selected Targets",[game.user.id,e,e.filter(t=>t.actor)]),e}),d(C,"getTargetDescriptors",()=>{var t,o;const e=new Map;for(const n of game.user.targets){const{name:l}=n,{img:u,system:k,uuid:P,statuses:f}=n.actor??{};if(P){const S=f.has("coverTotal")?null:(o=(t=k.attributes)==null?void 0:t.ac)==null?void 0:o.value;e.set(P,{name:l,img:u,uuid:P,ac:S??null})}}return Array.from(e.values())}),d(C,"findItemFromActor",(e,t,o)=>{const n=game.actors.get(e);if(r.log("findItemFromActor",[t,o]),!n)return null;let l=t?n.items.find(u=>u.id===t):null;return l||(l=o?n.items.find(u=>u.name.toLowerCase()===o.toLowerCase()):null,l||(l=n.items.find(u=>u.name.toLowerCase()===(o+" (Legacy)").toLowerCase()))),l}),d(C,"addCSSVars",(e,t)=>{let o=document.querySelector("#crlngn-chat-vars");if(!o){const L=document.querySelector("body");o=document.createElement("style"),o.id="crlngn-chat-vars",o.textContent=`body.crlngn-chat {
}
`,L.prepend(o)}let n=o.textContent,l=n.indexOf("body.crlngn-chat {"),u=n.indexOf("}",l);l===-1&&(n=`body.crlngn-chat {
}
`,l=0,u=n.indexOf("}"));const P=n.substring(l+18,u).split(";").map(L=>L.trim()).filter(L=>L!==""),f={};P.forEach(L=>{const T=L.split(":");if(T.length>=2){const V=T[0].trim(),X=T.slice(1).join(":").trim();V&&(f[V]=X)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),f[e]=t;const S=Object.entries(f).map(([L,T])=>`  ${L}: ${T};`).join(`
`),Q=n.substring(0,l)+`body.crlngn-chat {
`+S+`
}`+n.substring(u+1);o.textContent=Q});var s,y,N,D,w,M,v,G,x,F,z,K,B,$,j,q,W,Y,J,U;const i=class i{static init(){Hooks.on(g.PRE_ROLL_V2,a(i,s,y)),Hooks.on(g.PRE_ROLL_ABILITY_CHECK,a(i,s,N)),Hooks.on(g.PRE_ROLL_SAVING_THROW,a(i,s,D)),Hooks.on(g.PRE_BEGIN_CONCENTRATING,a(i,s,w)),Hooks.on(g.PRE_END_CONCENTRATION,a(i,s,M)),Hooks.on(g.PRE_ROLL_CONCENTRATION_V2,a(i,s,v)),Hooks.on(g.PRE_ROLL_DEATH_SAVE_V2,a(i,s,G)),Hooks.on(g.PRE_ROLL_SKILL_V2,a(i,s,x)),Hooks.on(g.PRE_ROLL_TOOL_CHECK_V2,a(i,s,F)),Hooks.on(g.PRE_ROLL_HIT_DIE_V2,a(i,s,z)),Hooks.on(g.PRE_ROLL_CLASS_HIT_POINTS,a(i,s,K)),Hooks.on(g.PRE_ROLL_NPC_HIT_POINTS,a(i,s,B)),Hooks.on(g.PRE_ROLL_INITIATIVE_DIALOG,a(i,s,$)),Hooks.on(g.PRE_ROLL_INITIATIVE,a(i,s,j)),Hooks.on(g.PRE_ROLL_ATTACK_V2,a(i,s,q)),Hooks.on(g.PRE_ROLL_DAMAGE_V2,a(i,s,W)),Hooks.on(g.PRE_ROLL_FORMULA_V2,a(i,s,Y)),Hooks.on(g.PRE_ROLL_RECHARGE_V2,a(i,s,J)),Hooks.on(g.POST_ROLL_CONFIG,a(i,s,U))}static getPlayerOwner(e){return game.users.find(t=>{var o;return((o=t.character)==null?void 0:o.id)===e})}};s=new WeakSet,y=function(e,t,o){r.log("#onPreRollV2",[e,t,o]);const n=e.subject;if(!n)return;const l=n.hasPlayerOwner?C.findItemFromActor(n.id):null;r.log("#onPreRollV2 - playerOwner",[l])},N=function(e){r.log("#onPreRollAbilityCheck",[e])},D=function(e){r.log("#onPreRollSavingThrow",[e])},w=function(e,t){r.log("#onPreBeginConcentrating",[e,t])},M=function(e,t){r.log("#onPreEndConcentration",[e,t])},v=function(e,t,o){r.log("#onPreRollConcentrationV2",[e,t,o])},G=function(e,t,o){r.log("#onPreRollDeathSaveV2",[e,t,o])},x=function(e,t,o){r.log("#onPreRollSkillV2",[e,t,o])},F=function(e,t,o){r.log("#onPreRollToolCheckV2",[e,t,o])},z=function(e,t,o){r.log("#onPreRollHitDieV2",[e,t,o])},K=function(e,t,o){r.log("#onPreRollClassHitPoints",[e,t,o])},B=function(e,t){r.log("#onPreRollNPCHitPoints",[e,t])},$=function(e){r.log("#onPreRollInitiativeDialog",[e])},j=function(e,t){r.log("#onPreRollInitiative",[e,t])},q=function(e,t,o){r.log("#onPreRollAttackV2",[e,t,o])},W=function(e,t,o){r.log("#onPreRollDamageV2",[e,t,o])},Y=function(e,t,o){r.log("#onPreRollFormulaV2",[e,t,o])},J=function(e){r.log("#onPreRollRechargeV2",[e])},U=function(e,t,o,n){r.log("#onPostRollConfiguration",[e,t,o,n])},b(i,s);let A=i;class se{static init(){Hooks.once(H.INIT,()=>{var e;m(),r.log("Initiating module...",[],!0),O.registerSettings(),A.init(),(e=game.modules.get("socketlib"))!=null&&e.active?p.initialize():ui.notifications.error(game.i18n.localize("CRLNGN_ROLLS.notifications.socketlibMissing"),{permanent:!0})}),Hooks.once(H.READY,()=>{r.log("Core Ready",[]);const e=m();var t=O.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0)})}}se.init();
//# sourceMappingURL=crlngn-roll-requests.js.map
